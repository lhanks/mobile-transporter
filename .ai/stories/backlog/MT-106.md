# MT-106: Real-time File Updates (WebSocket)

## Description

Broadcast file changes to all connected clients via WebSocket events.

## Acceptance Criteria

- [ ] Server emits `file:added` after successful upload
- [ ] Server emits `file:removed` after successful delete
- [ ] React hook `useFileSync()` listens to file events
- [ ] Client file list updates automatically on events
- [ ] Upload on device A instantly shows on device B
- [ ] Delete on device A instantly removes from device B
- [ ] No polling required

## Technical Notes

### Server Events

```typescript
// After successful upload
io.emit('file:added', { file: fileMetadata });

// After successful delete
io.emit('file:removed', { id: fileId });
```

### Client Hook

```typescript
// useFileSync.ts
import { useEffect, useState, useCallback } from 'react';
import { useSocket } from './useSocket';
import { FileMetadata } from '../../shared/types';

export function useFileSync() {
  const { socket } = useSocket();
  const [files, setFiles] = useState<FileMetadata[]>([]);

  // Initial fetch
  useEffect(() => {
    fetch('/api/files')
      .then(res => res.json())
      .then(setFiles);
  }, []);

  // Real-time updates
  useEffect(() => {
    if (!socket) return;

    socket.on('file:added', ({ file }) => {
      setFiles(prev => [...prev, file]);
    });

    socket.on('file:removed', ({ id }) => {
      setFiles(prev => prev.filter(f => f.id !== id));
    });

    return () => {
      socket.off('file:added');
      socket.off('file:removed');
    };
  }, [socket]);

  return { files };
}
```

## Files to Create

- `src/client/hooks/useFileSync.ts` - File sync hook

## Files to Modify

- `src/server/routes/files.ts` - Emit events on upload/delete
- `src/server/index.ts` - Export io instance for routes

## Dependencies

- Depends on: MT-104 (File List/Download API), MT-105 (WebSocket Setup)
