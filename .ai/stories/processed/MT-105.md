# MT-105: WebSocket Connection Setup

## Description

Establish Socket.io connection between client and server for real-time communication.

## Acceptance Criteria

- [ ] Socket.io configured on Express server
- [ ] Socket event handlers file created
- [ ] React hook `useSocket()` connects to server
- [ ] Server emits `device:joined` on new connection
- [ ] Server emits `device:left` on disconnect
- [ ] Connection/disconnection logged on server
- [ ] Auto-reconnect on connection loss

## Technical Notes

### Server Setup

```typescript
import { Server } from 'socket.io';
import { createServer } from 'http';

const httpServer = createServer(app);
const io = new Server(httpServer, {
  cors: { origin: 'http://localhost:5173' }
});

io.on('connection', (socket) => {
  console.log('Device connected:', socket.id);
  io.emit('device:joined', { id: socket.id });

  socket.on('disconnect', () => {
    console.log('Device disconnected:', socket.id);
    io.emit('device:left', { id: socket.id });
  });
});
```

### Client Hook

```typescript
// useSocket.ts
import { useEffect, useState } from 'react';
import { io, Socket } from 'socket.io-client';

export function useSocket() {
  const [socket, setSocket] = useState<Socket | null>(null);
  const [connected, setConnected] = useState(false);

  useEffect(() => {
    const s = io('http://localhost:3001');
    s.on('connect', () => setConnected(true));
    s.on('disconnect', () => setConnected(false));
    setSocket(s);
    return () => { s.disconnect(); };
  }, []);

  return { socket, connected };
}
```

## Files to Create

- `src/server/socket/handlers.ts` - Socket event handlers
- `src/client/hooks/useSocket.ts` - Socket connection hook

## Files to Modify

- `src/server/index.ts` - Add Socket.io setup

## Dependencies

- Depends on: MT-101 (Project Scaffolding)
- Install: `socket.io-client` on client side
